<html>
<head>
   <link rel="stylesheet" href="css/reveal.css">
   <link rel="stylesheet" href="css/font-awesome/css/font-awesome.min.css">
   <link rel="stylesheet" href="css/theme/league.css">
   <link rel="stylesheet" href="css/overrides.css">
   <title>Flask</title>
</head>
<body>
<div class="reveal">
   <div class="slides">

      <!------------------------------------------------------
         Intro
      ------------------------------------------------------->

     <section data-transition="none">
         <h2>Shopping with Django</h2>
        <h4>Viral Tools Web Application</h4>
     </section>

     <section data-transition="none">

         <h3>Viral App</h3>
         <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/viral3.png" />
            </div>
         </div>
     </section>

     <section data-transition="none">
         <h3>Viral App</h3>
         <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/viral7.png" />
            </div>
         </div>
     </section>

     <section data-transition="none">
         <h3>Viral App</h3>
         <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/viral1.png" />
            </div>
         </div>
     </section>

     <section data-transition="none">
         <h3>Viral App</h3>
         <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/viral2.png" />
            </div>
         </div>
     </section>

     <section>
         <h3>Stats</h3>
          <ul>
            <li>~ 150 Requester</li>
            <li>~ 400 Orders</li>
            <li>~ 210 Orders from Janelia</li>
            <li>~ 65 Requester from Janelia</li>
            <li>~ 800 Different Items in the Inventory</li>
            <li>~ 130 Routes</li>
          </ul>
      </section>

     <section>
       <h3>Current Process</h3>
          <div class="slide-pictures-container stillmany">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/janelia-org.png" />
            </div>
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/cognito.png" />
            </div>
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/spreadsheet.png" />
            </div>
         </div>
     </section>

     <section>
       <h3>Current Process</h3>
          <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/spreadsheet.png" />
            </div>
         </div>
     </section>

     <section>
       <h3>Current Process</h3>
          <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/spreadsheet2.png" />
            </div>
         </div>
     </section>

     <section>
       <h3>Current Process</h3>
          <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/spreadsheet3.png" />
            </div>
         </div>
     </section>

     <section>
       <h3>Why switch?</h3>
       <ul>
          <li>App provides a simplified login using HHMI Okta</li>
          <li>Data validation possible (uniqueness constraints etc.)<br/>
            <code style="font-size: 0.75em;">
              <pre>
                class Tube(AuditableTable):
                class Meta:
                  unique_together = ('box', 'space')

                box = models.ForeignKey(Box, null=True, related_name='tube')
                concentration = models.FloatField(blank=True, default=0)
                (...)
              </pre>
            </code>
          </li>
         <li>Customer can monitor the status of their requests</li>
         <li>Alerts and Notifications, Reporting, Permissions</li>
       </ul>
     </section>

     <section data-transition="none">
         <h3>Architecture</h3>
         <div class="slide-pictures-container few">
            <div class="">
               <img class="" src="img/django/architecture.svg" />
            </div>
         </div>
         <ul>
            <li>Fully dockerized application using Docker Compose</li>
            <li>Compose is a tool for defining and running multi-container Docker applications.</li>
         </ul>
     </section>

     <section data-transition="none">
         <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic logo" src="img/django/easter-eggs.jpg" />
            </div>
         </div>
     </section>

     <section data-transition="none">
         <h3>What went wrong?</h3>
         <ul>
            <li>Major focus on user interface, not internal logic</li>
            <li>Views work only with uploaded data</li>
            <li>Wrong implementation of data manipulation tasks</li>
         </ul>
      </section>

     <section data-transition="none"><br/>
         <h3>Data Manipulation</h3>
          <ul style="list-style-type: none;">
            <li><i class="icon-green fa fa-check" aria-hidden="true"></i> User interaction ("Press button")</li>
            <li><i class="icon-green fa fa-check" aria-hidden="true"></i> Event-based ("Create new record")</li>
            <li><i class="icon-green fa fa-check" aria-hidden="true"></i> Recurring background job (weekly / nightly)</li><br/>
            <li><i class="icon-red fa fa-times" aria-hidden="true"></i> Not when opening a view!</li>
            <a href="https://viraltools.janelia.org/service/prep/10493/">https://viraltools.janelia.org/service/prep/10493/</a>
            <a href="https://github.com/JaneliaSciComp/VirusServices/blob/1813875d6ec97ba4b706fa60e75a1f99159d7667/service/views.py">github.com/service/views.py</a><br/>
          </ul>
      </section>

     <section data-transition="none"><br/>
         <h3>Data Manipulation</h3>
          <span style="font-size: smaller"><a style="font-size: smaller;" href="https://github.com/JaneliaSciComp/VirusServices/blob/1813875d6ec97ba4b706fa60e75a1f99159d7667/service/views.py">github.com/service/views.py</a><br/></span>
          <div class="slide-pictures-container more">
            <div class="">
               <img class="" src="img/django/preps.png" />
            </div>
         </div>
      </section>

     <section data-transition="none"><br/>
         <h3>Data Display vs. View</h3>
          <ul style="list-style-type: none;">
            <li>Internal value (stored in database)</li>
            <li>Display value &mdash; user-friendly, human-readable</li>
            <code style="font-size: 0.75em;">
              <pre>
                DNA_SOURCE = (
                  ('r', 'Requester'),
                  ('m', 'Molecular Biology'),
                  ('v', 'Viral Tools')
                )

                class Prep(AuditableTable):
                  order_id = models.ForeignKey('customer.Order', related_name='preps')
                  batch_id = models.ForeignKey(Batch, related_name='batch', null=True, blank=True)

                  DNA_source = models.CharField(max_length=50, blank=True, choices=DNA_SOURCE)
              </pre>
            </code>
            <li><span style="font-size: smaller"><a href="https://github.com/JaneliaSciComp/VirusServices/blob/1813875d6ec97ba4b706fa60e75a1f99159d7667/service/templates/view_prep.html">github.com/view_prep.html</a></span></li><br/>
          </ul>
      </section>


     <section data-transition="none"><br/>
         <h3>Data Display vs. View</h3>
          <div class="slide-pictures-container few">
            <div class="slide-picture">
               <img class="slide-pic" src="img/django/view_code.png" />
            </div>
         </div>
      </section>

     <section>
       <h3><i class="icon-green fa fa-check" aria-hidden="true"></i> Fat Models</h3>
       <p>
	      <cite>
          "The idea &mdash; often presented as a common pattern in MVC-style programming &mdash; is to build thick/fat models and thin controllers.<br/>
          In Django, that translates to thick models with lots and lots of small methods and thin views which use those methods and keep their logic as minimal as possible. There are lots of benefits to this approach."
        </cite>
       </p>
       <span style="font-size: small;"><a href="https://sunscrapers.com/blog/where-to-put-business-logic-django/">https://sunscrapers.com/blog/where-to-put-business-logic-django/</a></span>
      </section>

     <section>
       <h3><i class="icon-red fa fa-times" aria-hidden="true"></i> Putting Business Logic in Views/Forms</h3>
       <p>
	      <cite>
          (...) I don't think that putting business logic in forms, views, or serializers is a clean idea. (...)<br/>
          The main reason for that is the miniscule chance that the form, view, or serializer will ever serve as the only entry point of that particular scenario. (...).<br/>
          Just don't do that.
        </cite>
       </p>
       <span style="font-size: small;"><a href="https://sunscrapers.com/blog/where-to-put-business-logic-django/">https://sunscrapers.com/blog/where-to-put-business-logic-django/</a></span>
      </section>

     <section data-transition="none">
         <h3>Django Signals</h3>
          <ul>
            <li>Event-based ("create a new record")</li>
            <li>Sender / Receiver Principle </li>
            <li>Allows Decoupling within the application
            </li>
          </ul>
          <code>
             <pre>
                  django.db.models.signals.pre_save <br/>
                  django.db.models.signals.post_save <br/>
                  django.db.models.signals.pre_delete <br/>
                  django.db.models.signals.post_delete<br/>
                  django.core.signals.request_started<br/>
                  django.core.signals.request_finished<br/>
             </pre>
          </code>
      </section>

      <section data-transition="none">
         <h3>Django Signals</h3>
          <ul>
            <li>Event-based ("create a new record")</li>
            <li>Sender / Receiver Principle </li>
            <li>Allows Decoupling within the application</li>
          </ul>
          <code>
             <pre>
               # Compute a valid Order name based on the Orders in the system
               @receiver(pre_save, sender=Tube)
               def tube_save_before(sender, instance, *args, **kwargs):
                if instance:
                  # Get tube before saving
                  t = Tube.objects.filter(id=instance.id).first()
                  if t is not None and (t.volume != instance.volume):
                      th = Tube_History(
                          tube=t,
                          volume=t.volume,
                          concentration=t.concentration
                      )
                      th.save()
             </pre>
          </code>
      </section>

      <section data-transition="none">
         <h3>Django Commands</h3>
          <ul style="list-style-type: none;">
            <li>Allow to use Django ORM for data manipulation instead of pure SQL:</li>
              <pre>
                <code>
                  capsid = Item(
                    alias=capsid_name,
                    name=capsid_name,
                    VS_name=capsid_name,
                    category=capsid_category,
                    created_by=getDefUser()
                  )
                  capsid.save()

                  users = User.objects.filter(email=email).first()
                </code>
              </pre>
          </ul>
      </section>

     <section>
       <h3>Project Plan</h3>
       <div class="slide-pictures-container few">
          <div class="slide-picture">
             <img class="slide-pic" src="img/django/gantt.png" />
          </div>
       </div>
     </section>

     <section>
       <h3>How-to?</h3>
       <div>
         <ol>
           <li class="fragment">Install Docker</li>
           <li class="fragment">Install Docker-Compose</li>
           <li class="fragment">Download docker compose file</li>
           <li class="fragment">Run docker-compose pull</li>
           <li class="fragment">Run docker-compose up</li>
           <li class="fragment">Done!</li>
         </ol>
       </div>
     </section>
   </div>
</div>
<script src="lib/js/head.min.js"></script>
<script src="js/reveal.js"></script>

<script>
   // More info about config & dependencies:
   // - https://github.com/hakimel/reveal.js#configuration
   // - https://github.com/hakimel/reveal.js#dependencies
   Reveal.initialize(
       {
          dependencies: [
             {src: 'plugin/markdown/marked.js'},
             {src: 'plugin/markdown/markdown.js'},
             {src: 'plugin/notes/notes.js', async: true},
             {
                src: 'plugin/highlight/highlight.js', async: true, callback: function () {
                hljs.initHighlightingOnLoad();
             }
             }
          ],
          slideNumber: true,
          transition: 'none',
          previewLinks: false,
          controls: true,
          progress: true,
          history: true,

       },
   );
</script>
</body>
</html>
